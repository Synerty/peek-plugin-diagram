webpackJsonp([1],{0:function(t,e,o){t.exports=o("cDNt")},"5wLy":function(t,e){t.exports='\n<pl-diagram-canvas *ngIf="modelSetKey != null" [modelSetKey]="modelSetKey"></pl-diagram-canvas>'},"8Sw2":function(t,e,o){var n={"./af":"FQor","./af.js":"FQor","./ar":"EcI0","./ar-dz":"cw72","./ar-dz.js":"cw72","./ar-kw":"fu+8","./ar-kw.js":"fu+8","./ar-ly":"7CVz","./ar-ly.js":"7CVz","./ar-ma":"1dFW","./ar-ma.js":"1dFW","./ar-sa":"UxV2","./ar-sa.js":"UxV2","./ar-tn":"nm31","./ar-tn.js":"nm31","./ar.js":"EcI0","./az":"EbpX","./az.js":"EbpX","./be":"SQlX","./be.js":"SQlX","./bg":"R3V+","./bg.js":"R3V+","./bm":"mH+W","./bm.js":"mH+W","./bn":"cAX3","./bn.js":"cAX3","./bo":"dHgA","./bo.js":"dHgA","./br":"W7ww","./br.js":"W7ww","./bs":"lZ6K","./bs.js":"lZ6K","./ca":"udbC","./ca.js":"udbC","./cs":"oSQb","./cs.js":"oSQb","./cv":"yPEm","./cv.js":"yPEm","./cy":"PpYB","./cy.js":"PpYB","./da":"oiZG","./da.js":"oiZG","./de":"LYe6","./de-at":"KOG5","./de-at.js":"KOG5","./de-ch":"o3JY","./de-ch.js":"o3JY","./de.js":"LYe6","./dv":"OkYT","./dv.js":"OkYT","./el":"QFnp","./el.js":"QFnp","./en-au":"dBGl","./en-au.js":"dBGl","./en-ca":"vv0C","./en-ca.js":"vv0C","./en-gb":"IoCy","./en-gb.js":"IoCy","./en-ie":"qVAg","./en-ie.js":"qVAg","./en-nz":"FbT0","./en-nz.js":"FbT0","./eo":"y/6j","./eo.js":"y/6j","./es":"ivpd","./es-do":"DBbP","./es-do.js":"DBbP","./es-us":"RJPF","./es-us.js":"RJPF","./es.js":"ivpd","./et":"FrUj","./et.js":"FrUj","./eu":"LAVD","./eu.js":"LAVD","./fa":"J2cK","./fa.js":"J2cK","./fi":"5FCP","./fi.js":"5FCP","./fo":"jIZb","./fo.js":"jIZb","./fr":"Lq8I","./fr-ca":"ICRA","./fr-ca.js":"ICRA","./fr-ch":"QWmo","./fr-ch.js":"QWmo","./fr.js":"Lq8I","./fy":"Fbnp","./fy.js":"Fbnp","./gd":"zhFu","./gd.js":"zhFu","./gl":"o10m","./gl.js":"o10m","./gom-latn":"UoXv","./gom-latn.js":"UoXv","./gu":"yUwm","./gu.js":"yUwm","./he":"gbvS","./he.js":"gbvS","./hi":"+UQz","./hi.js":"+UQz","./hr":"qGYH","./hr.js":"qGYH","./hu":"hGGh","./hu.js":"hGGh","./hy-am":"1AR5","./hy-am.js":"1AR5","./id":"Ie9h","./id.js":"Ie9h","./is":"piS+","./is.js":"piS+","./it":"5P9/","./it.js":"5P9/","./ja":"3cRe","./ja.js":"3cRe","./jv":"vwCJ","./jv.js":"vwCJ","./ka":"R7aq","./ka.js":"R7aq","./kk":"d8hV","./kk.js":"d8hV","./km":"nCdc","./km.js":"nCdc","./kn":"5K8n","./kn.js":"5K8n","./ko":"1jN3","./ko.js":"1jN3","./ky":"74/W","./ky.js":"74/W","./lb":"XAyT","./lb.js":"XAyT","./lo":"w/Mz","./lo.js":"w/Mz","./lt":"IetG","./lt.js":"IetG","./lv":"CRPd","./lv.js":"CRPd","./me":"1mee","./me.js":"1mee","./mi":"yRr3","./mi.js":"yRr3","./mk":"bfn1","./mk.js":"bfn1","./ml":"r1ky","./ml.js":"r1ky","./mr":"+K6p","./mr.js":"+K6p","./ms":"asMk","./ms-my":"IcWU","./ms-my.js":"IcWU","./ms.js":"asMk","./mt":"yJmD","./mt.js":"yJmD","./my":"Isng","./my.js":"Isng","./nb":"FjNp","./nb.js":"FjNp","./ne":"P9zQ","./ne.js":"P9zQ","./nl":"pejQ","./nl-be":"c3/i","./nl-be.js":"c3/i","./nl.js":"pejQ","./nn":"ALD8","./nn.js":"ALD8","./pa-in":"1YTd","./pa-in.js":"1YTd","./pl":"Gs99","./pl.js":"Gs99","./pt":"eunO","./pt-br":"uHKL","./pt-br.js":"uHKL","./pt.js":"eunO","./ro":"1FZw","./ro.js":"1FZw","./ru":"Cy48","./ru.js":"Cy48","./sd":"+28k","./sd.js":"+28k","./se":"EiHj","./se.js":"EiHj","./si":"77bI","./si.js":"77bI","./sk":"BgyH","./sk.js":"BgyH","./sl":"K7sG","./sl.js":"K7sG","./sq":"pwQJ","./sq.js":"pwQJ","./sr":"N0T2","./sr-cyrl":"9OoP","./sr-cyrl.js":"9OoP","./sr.js":"N0T2","./ss":"Mh9L","./ss.js":"Mh9L","./sv":"YZAt","./sv.js":"YZAt","./sw":"/7jV","./sw.js":"/7jV","./ta":"VKBt","./ta.js":"VKBt","./te":"TIcV","./te.js":"TIcV","./tet":"BlC1","./tet.js":"BlC1","./th":"Zi3L","./th.js":"Zi3L","./tl-ph":"D4Y9","./tl-ph.js":"D4Y9","./tlh":"muBP","./tlh.js":"muBP","./tr":"82s3","./tr.js":"82s3","./tzl":"vjXv","./tzl.js":"vjXv","./tzm":"Vhfe","./tzm-latn":"m0Pg","./tzm-latn.js":"m0Pg","./tzm.js":"Vhfe","./uk":"Y3Ex","./uk.js":"Y3Ex","./ur":"4DIg","./ur.js":"4DIg","./uz":"wDue","./uz-latn":"Li28","./uz-latn.js":"Li28","./uz.js":"wDue","./vi":"UbP6","./vi.js":"UbP6","./x-pseudo":"fQLM","./x-pseudo.js":"fQLM","./yo":"evMD","./yo.js":"evMD","./zh-cn":"DV5H","./zh-cn.js":"DV5H","./zh-hk":"iEKH","./zh-hk.js":"iEKH","./zh-tw":"X9uL","./zh-tw.js":"X9uL"};function i(t){return o(r(t))}function r(t){var e=n[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}i.keys=function(){return Object.keys(n)},i.resolve=r,t.exports=i,i.id="8Sw2"},cDNt:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,i=o("/oeL"),r=o("Qa4U"),s=o("fc+i"),c=o("yMcj"),a=function(){return function(t,e,o){var n=this;this.lifeCycleEvents=t,this.service=e,this.iface=o;var i=e;this.iface.on("positionSubject",function(t){console.log("WEB: Received positionSubject event"),e.position(t.coordSetKey,t.x,t.y,t.zoom)}),this.iface.on("positionByCoordSetObservable",function(t){console.log("WEB: Received positionByCoordSetObservable event"),e.positionByCoordSet(t)}),t.onDestroyEvent.subscribe(function(){n.iface.off("positionSubject"),n.iface.off("positionByCoordSetObservable")}),i.isReadyObservable().takeUntil(t.onDestroyEvent).subscribe(function(t){console.log("WEB: Sending isReadySubject "+t),o.emit("isReadySubject",t)}),i.positionUpdatedObservable().takeUntil(t.onDestroyEvent).subscribe(function(t){console.log("WEB: Sending positionUpdated"),o.emit("positionUpdated",t)}),i.titleUpdatedObservable().takeUntil(t.onDestroyEvent).subscribe(function(t){console.log("WEB: Sending titleUpdatedSubject "+t),o.emit("titleUpdatedSubject",t)})}}(),l=function(){return function(t,e,o){this.lifeCycleEvents=t,this.service=e,this.iface=o,e.itemSelectObservable().takeUntil(t.onDestroyEvent).subscribe(function(t){console.log("WEB: Sending itemSelect event"),o.emit("itemSelected",t)})}}(),u=function(){return function(){}}(),f=o("Dqrr"),p=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},d=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},h=function(){function t(){this.itemSelectSubject=new f.Subject}return t.prototype.itemSelectObservable=function(){return this.itemSelectSubject},t.prototype.selectItem=function(t){this.itemSelectSubject.next(t)},t=p([Object(i.Injectable)(),d("design:paramtypes",[])],t)}(),y=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),v=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},_=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},g=function(t){function e(e,o,n){var i=t.call(this)||this;return i.vortexService=e,i.positionService=o,i.itemSelectService=n,i.modelSetKey=null,i.itemSelectServiceBridge=null,i.positionServiceBridge=null,i}return y(e,t),e.prototype.ngOnInit=function(){var t={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,o,n){return t[o]=n}),this.modelSetKey=t.modelSetKey;var e=t.vortexWsUrl;if(null!=e&&(c.VortexService.setVortexUrl(e),this.vortexService.reconnect()),null==this.modelSetKey||0==this.modelSetKey.length)throw alert("modelSetKey set is empty or null"),new Error("modelSetKey set is empty or null");this.oWebViewInterface=window.nsWebViewInterface,this.itemSelectServiceBridge=new l(this,this.itemSelectService,this.oWebViewInterface),this.positionServiceBridge=new a(this,this.positionService,this.oWebViewInterface)},e=v([Object(i.Component)({selector:"ns-web-diagram",template:o("5wLy")}),_("design:paramtypes",["function"==typeof(n="undefined"!=typeof c.VortexService&&c.VortexService)&&n||Object,"function"==typeof(r="undefined"!=typeof u&&u)&&r||Object,"function"==typeof(s="undefined"!=typeof h&&h)&&s||Object])],e);var n,r,s}(c.ComponentLifecycleEventEmitter),b=o("qbdv"),m=o("kzAo");o("uI+l");function S(t,e){void 0===e&&(e=!1);var o=[];for(var n in t)n.startsWith("_")&&!e||!t.hasOwnProperty(n)||"function"==typeof n||o.push(n);return o}function w(t){var e=[];for(var o in t)o.startsWith("_")||e.push(t[o]);return e}var O=function(){function t(t){this.message=t}return t.prototype.toString=function(){return"AssertException: "+this.message},t}();function j(t,e){if(!t)throw console.trace(),new O(e)}var P,x,R,T,D,C,E,I,B,k,G,A,L={plugin:"peek_plugin_diagram"},N="peek_plugin_diagram.",M="peek_plugin_diagram",K="peek_plugin_diagram",U="peek_plugin_diagram",V="peek_plugin_diagram_grids",z="peek_plugin_diagram_location_index",F=this&&this.__extends||(P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}P(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),W=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},Z=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},H=(function(t){function e(){return t.call(this,o.tupleName)||this}return F(e,t),o=e,e.tupleName=N+"DiagramLoaderStatusTuple",e=o=W([c.addTupleType,Z("design:paramtypes",[])],e);var o}(c.Tuple),this&&this.__extends||(x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}x(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)})),Y=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},X=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Q=(function(t){function e(){return t.call(this,o.tupleName)||this}return H(e,t),o=e,e.tupleName=N+"SettingProperty",e=o=Y([c.addTupleType,X("design:paramtypes",[])],e);var o}(c.Tuple),this&&this.__extends||(R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}R(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)})),J=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},q=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},$=function(t){function e(){return t.call(this,o.tupleName)||this}return Q(e,t),o=e,e.tupleName=N+"DispLevel",e=o=J([c.addTupleType,q("design:paramtypes",[])],e);var o}(c.Tuple),tt=this&&this.__extends||(T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}T(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),et=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},ot=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},nt=function(t){function e(){return t.call(this,o.tupleName)||this}return tt(e,t),o=e,e.tupleName=N+"DispLayer",e=o=et([c.addTupleType,ot("design:paramtypes",[])],e);var o}(c.Tuple),it=this&&this.__extends||(D=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}D(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),rt=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},st=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ct=function(t){function e(){return t.call(this,o.tupleName)||this}return it(e,t),o=e,e.tupleName=N+"DispColor",e=o=rt([c.addTupleType,st("design:paramtypes",[])],e);var o}(c.Tuple),at=this&&this.__extends||(C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}C(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),lt=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},ut=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ft=function(t){function e(){return t.call(this,o.tupleName)||this}return at(e,t),o=e,e.tupleName=N+"DispTextStyle",e=o=lt([c.addTupleType,ut("design:paramtypes",[])],e);var o}(c.Tuple),pt=this&&this.__extends||(E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}E(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),dt=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},ht=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},yt=function(t){function e(){var e=t.call(this,o.tupleName)||this;return e.CAP_BUTT="butt",e.CAP_ROUND="round",e.CAP_SQUARE="square",e.JOIN_BEVEL="bevel",e.JOIN_ROUND="round",e.JOIN_MITER="miter",e}return pt(e,t),o=e,e.tupleName=N+"DispLineStyle",e=o=dt([c.addTupleType,ht("design:paramtypes",[])],e);var o}(c.Tuple),vt=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},_t=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},gt=function(){function t(t,e,o,n,i){var r=new c.TupleDataObservableNameService(M,L),s=new c.TupleOfflineStorageNameService(U),a=new c.TupleActionPushNameService(K,L),l=new c.TupleOfflineStorageService(n,s);this.tupleObserver=new c.TupleDataObserverService(e,o,i,r),this.tupleOfflineObserver=new c.TupleDataOfflineObserverService(e,o,i,r,l),this.tupleOfflineAction=new c.TupleActionPushOfflineService(a,e,o,t)}return t=vt([Object(i.Injectable)(),_t("design:paramtypes",["function"==typeof(e="undefined"!=typeof c.TupleActionPushOfflineSingletonService&&c.TupleActionPushOfflineSingletonService)&&e||Object,"function"==typeof(o="undefined"!=typeof c.VortexService&&c.VortexService)&&o||Object,"function"==typeof(n="undefined"!=typeof c.VortexStatusService&&c.VortexStatusService)&&n||Object,"function"==typeof(r="undefined"!=typeof c.TupleStorageFactoryService&&c.TupleStorageFactoryService)&&r||Object,"function"==typeof(s="undefined"!=typeof i.NgZone&&i.NgZone)&&s||Object])],t);var e,o,n,r,s}(),bt=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},mt=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},St=function(){function t(t){this.tupleService=t,this.modelSetKey="",this.loadedCounter={},this._lookupTargetCount=5,this._levelsById={},this._layersById={},this._colorsById={},this._textStyleById={},this._lineStyleById={},this._levelsByCoordSetIdOrderedByOrder={},this._layersOrderedByOrder=[],this.subscriptions=[],this._isReady=!1}return t.prototype.setModelSetKey=function(t){this.modelSetKey=t,this.initialLoad()},t.prototype.initialLoad=function(){var t=this,e=function(e,o,n){void 0===n&&(n=null),t.subscriptions.push(t.tupleService.tupleOfflineObserver.subscribeToTupleSelector(new c.TupleSelector(o,{modelSetKey:t.modelSetKey})).subscribe(function(o){if(o.length){t.loadedCounter[e]=!0,t[e]={};for(var i=0;i<o.length;i++){var r=o[i];t[e][r.id]=r}null!=n&&n()}}))};e("_levelsById",$.tupleName,function(){return t.createLevelsOrderedByOrder()}),e("_layersById",nt.tupleName,function(){return t.createLayersOrderedByOrder()}),e("_colorsById",ct.tupleName,function(){return t._validateColors()}),e("_textStyleById",ft.tupleName),e("_lineStyleById",yt.tupleName,function(){return t._convertLineStyleDashPattern()})},t.prototype.isReady=function(){if(this._isReady)return!0;var t=S(this.loadedCounter,!0).length;return this._lookupTargetCount==t&&(this._isReady=!0,!0)},t.prototype.shutdown=function(){for(var t=0,e=this.subscriptions;t<e.length;t++){e[t].unsubscribe()}this.subscriptions=[]},t.prototype._validateColors=function(){function t(t){if(""===t)return!1;if("inherit"===t)return!1;if("transparent"===t)return!1;var e=document.createElement("img");return e.style.color="rgb(0, 0, 0)",e.style.color=t,"rgb(0, 0, 0)"!==e.style.color||(e.style.color="rgb(255, 255, 255)",e.style.color=t,"rgb(255, 255, 255)"!==e.style.color)}for(var e=w(this._colorsById),o=0;o<e.length;o++){var n=e[o];t(n.color)||(console.log("Color "+n.color+" is not a valid CSS color"),n.color="green")}},t.prototype.levelForId=function(t){return this._levelsById[t]},t.prototype.layerForId=function(t){return this._layersById[t]},t.prototype.colorForId=function(t){return this._colorsById[t]},t.prototype.textStyleForId=function(t){return this._textStyleById[t]},t.prototype.lineStyleForId=function(t){return this._lineStyleById[t]},t.prototype.layersOrderedByOrder=function(){return this._layersOrderedByOrder},t.prototype.levelsOrderedByOrder=function(t){var e=this._levelsByCoordSetIdOrderedByOrder[t];return null==e?[]:e},t.prototype.createLayersOrderedByOrder=function(){this._layersOrderedByOrder=w(this._layersById).sort(function(t,e){return t.order-e.order})},t.prototype.createLevelsOrderedByOrder=function(){var t={};this._levelsByCoordSetIdOrderedByOrder=t;for(var e=w(this._levelsById).sort(function(t,e){return t.order-e.order}),o=0;o<e.length;o++){var n=e[o];null==t[n.coordSetId]&&(t[n.coordSetId]=[]),t[n.coordSetId].push(n)}},t.prototype._convertLineStyleDashPattern=function(){for(var t=0,e=w(this._lineStyleById);t<e.length;t++){var o=e[t];null!=o.dashPattern&&(o.dashPattern=JSON.parse(""+o.dashPattern))}},t.prototype.linkDispLookups=function(t){return null!=t.le&&(t.lel=this._levelsById[t.le],null==t.lel)?null:null!=t.la&&(t.lal=this._layersById[t.la],null==t.lal)?null:null!=t.fs&&(t.fsl=this._textStyleById[t.fs],null==t.fsl)?null:null!=t.c&&(t.cl=this._colorsById[t.c],null==t.cl)?null:null!=t.lc&&(t.lcl=this._colorsById[t.lc],null==t.lcl)?null:null!=t.fc&&(t.fcl=this._colorsById[t.fc],null==t.fcl)?null:null!=t.ls&&(t.lsl=this._lineStyleById[t.ls],null==t.lsl)?null:t},t=bt([Object(i.Injectable)(),mt("design:paramtypes",["function"==typeof(e="undefined"!=typeof gt&&gt)&&e||Object])],t);var e}(),wt=function(){function t(t,e){if(void 0===e&&(e=null),this.gridKey=null,this.lastUpdate=null,this.loadedFromServerDate=new Date,this.disps=[],"string"!=typeof t){var o=t;j(null!=e,"lookupStore can not be null"),this.gridKey=o.gridKey,this.lastUpdate=o.lastUpdate,this.loadedFromServerDate=new Date,this.disps=[];var n=[];if(null!=o.dispJsonStr&&0!=o.dispJsonStr.length)try{n=JSON.parse(o.dispJsonStr)}catch(t){console.error(t.toString())}for(var i=0;i<n.length;i++){var r=n[i];null!=r.id&&(null!=e.linkDispLookups(r)&&this.disps.push(r))}}else this.gridKey=t}return t.prototype.hasData=function(){return!(null==this.lastUpdate&&0==this.disps.length)},t}(),Ot=o("iRZW"),jt=this&&this.__extends||(I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}I(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),Pt=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},xt=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Rt=function(t){function e(){var e=t.call(this,o.tupleName)||this;return e._rawJonableFields=["data"],e.data={},e}return jt(e,t),o=e,e.tupleName=N+"GridCacheIndexTuple",e=o=Pt([c.addTupleType,xt("design:paramtypes",[])],e);var o}(c.Tuple),Tt=this&&this.__extends||(B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}B(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),Dt=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},Ct=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Et=Object(c.extend)({key:"clientGridWatchUpdateFromDevice"},L),It=function(t){function e(e){return t.call(this,e,{})||this}return Tt(e,t),e.prototype.toOrderedJsonStr=function(){return this.name},e}(c.TupleSelector),Bt=function(){return function(){}}(),kt=(function(t){function e(e,o,n,i,r){var s=t.call(this)||this;return s.footerService=e,s.vortexService=o,s.vortexStatusService=n,s.tupleService=i,s.isReadySubject=new f.Subject,s.updatesObservable=new f.Subject,s.lifecycleEmitter=new c.ComponentLifecycleEventEmitter,s.lastWatchedGridKeys=[],s.gridCacheIndex=new Rt,s.cacheGridQueueChunks=[],s.chunksSavedSinceLastIndexSave=0,s.storage=r.create(new c.TupleOfflineStorageNameService(V)),s.storage.open().then(function(){return s.loadGridCacheIndex()}).then(function(){return s.isReadySubject.next(!0)}).catch(function(t){return console.log("Failed to open grid cache db "+t)}),s.vortexService.createEndpointObservable(s.lifecycleEmitter,Et).subscribe(function(t){return s.processGridsFromServer(t)}),s.vortexStatusService.isOnline.filter(function(t){return 1==t}).takeUntil(s.lifecycleEmitter.onDestroyEvent).subscribe(function(){return s.loadGrids({},s.lastWatchedGridKeys)}),s}return Tt(e,t),e.prototype.isReady=function(){return this.storage.isOpen()},e.prototype.isReadyObservable=function(){return this.isReadySubject},Object.defineProperty(e.prototype,"observable",{get:function(){return this.updatesObservable},enumerable:!0,configurable:!0}),e.prototype.cacheAll=function(){var t=this;this.vortexStatusService.snapshot.isOnline&&(this.footerService.setStatusText("Starting Cache Update"),this.tupleService.tupleObserver.pollForTuples(new c.TupleSelector(Rt.tupleName,{})).then(function(e){if(e.length){var o=e[0],n=[],i=0,r={};for(var s in o.data)if(o.data.hasOwnProperty(s)){var c=o.data[s],a=t.gridCacheIndex.data[s];null==a?(r[s]=null,i+=1):a!=c&&(r[s]=a,i+=1),15==i&&(n.push(r),i=0,r={})}i&&n.push(r),t.cacheGridQueueChunks=n,console.log("Cacheing "+t.cacheGridQueueChunks.length+" grid chunks"),t.cacheRequestNextChunk()}}).catch(function(t){return console.log("ERROR in cacheAll : "+t)}))},e.prototype.cacheRequestNextChunk=function(){if(this.chunksSavedSinceLastIndexSave++,0==this.cacheGridQueueChunks.length)return this.footerService.setStatusText("Caching Complete"),void this.saveGridCacheIndex(!0);this.saveGridCacheIndex(),this.footerService.setStatusText(this.cacheGridQueueChunks.length+" grids left"),console.log("Cacheing next grid chunk, "+this.cacheGridQueueChunks.length+" remaining");var t=this.cacheGridQueueChunks.pop(),e=new c.Payload(Object(c.extend)({cacheAll:!0},Et));e.tuples=[t],this.vortexService.sendPayload(e)},e.prototype.watchGrids=function(t){this.lastWatchedGridKeys=t},e.prototype.loadGrids=function(t,e){var o=this;this.queryStorageGrids(e).then(function(e){for(var n=0,i=e;n<i.length;n++){var r=i[n];t[r.gridKey]=r.lastUpdate}o.sendWatchedGridsToServer(t)})},e.prototype.sendWatchedGridsToServer=function(t){if(this.vortexStatusService.snapshot.isOnline){var e=new c.Payload(Et);e.tuples=[t],this.vortexService.sendPayload(e)}},e.prototype.processGridsFromServer=function(t){var e=this,o=t.tuples,n=!0===t.filt.cacheAll;n||this.emitEncodedGridTuples(o),this.storeGridTuples(o).then(function(){return n&&e.cacheRequestNextChunk()})},e.prototype.emitEncodedGridTuples=function(t){for(var e=this,o=[],n=[],i=0,r=t;i<r.length;i++){var s=r[i],a=c.Payload.fromVortexMsg(s.encodedGridTuple).then(function(t){n.push(t.tuples[0])}).catch(function(t){console.log("GridLoader.emitEncodedGridTuples decode error: "+t)});o.push(a)}Promise.all(o).then(function(){e.updatesObservable.next(n)}).catch(function(t){console.log("GridLoader.emitEncodedGridTuples all error: "+t)})},e.prototype.queryStorageGrids=function(t){var e=this;return this.storage.transaction(!1).then(function(o){for(var n=[],i=[],r=0,s=t;r<s.length;r++){var c=s[r];n.push(o.loadTuples(new It(c)).then(function(t){t.length&&(i.push(t[0]),e.updatesObservable.next(t))}))}return Promise.all(n).then(function(){return o.close().catch(function(t){return console.log("GridCache.queryStorageGrids commit:"+t)}),i})})},e.prototype.storeGridTuples=function(t){var e=this;if(0==t.length)return Promise.resolve();for(var o=[],n=0,i=t;n<i.length;n++){var r=i[n];o.push(r.gridKey)}return console.log("Caching grids "+o),this.storage.transaction(!0).then(function(o){for(var n=[],i=0,r=t;i<r.length;i++){var s=r[i];e.gridCacheIndex.data[s.gridKey]=s.lastUpdate,n.push(o.saveTuplesEncoded(new It(s.gridKey),s.encodedGridTuple))}return Promise.all(n).then(function(){return e.saveGridCacheIndex(!1,o)}).then(function(){return o.close()}).catch(function(t){return console.log("GridCache.storeGridTuples: "+t)})})},e.prototype.loadGridCacheIndex=function(){var t=this;return this.storage.transaction(!1).then(function(e){return e.loadTuples(new c.TupleSelector(Rt.tupleName,{})).then(function(e){e.length&&(t.gridCacheIndex=e[0])})})},e.prototype.saveGridCacheIndex=function(t,e){if(void 0===t&&(t=!1),void 0===e&&(e=null),this.chunksSavedSinceLastIndexSave<=20&&!t)return Promise.resolve();var o=new c.TupleSelector(Rt.tupleName,{}),n=[this.gridCacheIndex],i=function(t){return console.log("GridCache.storeGridCacheIndex: "+t)};return this.chunksSavedSinceLastIndexSave=0,null!=e?e.saveTuples(o,n).catch(i):this.storage.transaction(!0).then(function(t){return t.saveTuples(o,n)}).catch(i)},e=Dt([Object(i.Injectable)(),Ct("design:paramtypes",["function"==typeof(o="undefined"!=typeof Ot.a&&Ot.a)&&o||Object,"function"==typeof(n="undefined"!=typeof c.VortexService&&c.VortexService)&&n||Object,"function"==typeof(r="undefined"!=typeof c.VortexStatusService&&c.VortexStatusService)&&r||Object,"function"==typeof(s="undefined"!=typeof gt&&gt)&&s||Object,"function"==typeof(a="undefined"!=typeof c.TupleStorageFactoryService&&c.TupleStorageFactoryService)&&a||Object])],e);var o,n,r,s,a}(Bt),this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s}),Gt=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},At=(o("Ad+1"),function(){function t(){this.cache={}}return t.prototype.put=function(t){this.cache[t.gridKey]=t},t.prototype.get=function(t){return this.has(t)?this.cache[t]:null},t.prototype.del=function(t){delete this.cache[t]},t.prototype.has=function(t){return this.cache.hasOwnProperty(t)},t}()),Lt=function(){function t(t,e){var o=this;this.lookupCache=t,this.gridLoader=e,this.updatesObservable=new f.Subject,this.cacheQueue=[],this.MAX_CACHE=50,this.lifecycleEmitter=new c.ComponentLifecycleEventEmitter,this.gridLoader.observable.takeUntil(this.lifecycleEmitter.onDestroyEvent).subscribe(function(t){return o.processGridUpdates(t)})}return t.prototype.isReady=function(){return this.gridLoader.isReady()},Object.defineProperty(t.prototype,"observable",{get:function(){return this.updatesObservable},enumerable:!0,configurable:!0}),t.prototype.updateWatchedGrids=function(t){this.gridLoader.watchGrids(t);for(var e=this.rotateCache(t),o=0,n=w(e);o<n.length;o++){var i=n[o];this.updatesObservable.next(i)}for(var r=[],s={},c=0,a=t;c<a.length;c++){var l=a[c],u=e.get(l);s[l]=null==u?null:u.lastUpdate,null==u&&r.push(l)}this.gridLoader.loadGrids(s,r)},t.prototype.rotateCache=function(t){for(var e=new At,o=0,n=t;o<n.length;o++)for(var i=n[o],r=0,s=this.cacheQueue;r<s.length;r++){var c=s[r],a=!1;if(!a){var l=c.get(i);null!=l&&(e[i]=l,a=!0)}c.del(i)}for(this.cacheQueue.unshift(e);this.cacheQueue.length>this.MAX_CACHE;)this.cacheQueue.pop();return e},t.prototype.processGridUpdates=function(t){for(var e=this.cacheQueue[0],o=0,n=t;o<n.length;o++){var i=n[o],r=e[i.gridKey];if(null==r||r.lastUpdate!=i.lastUpdate){var s=new wt(i,this.lookupCache);e.put(s),this.updatesObservable.next(s)}}},t=kt([Object(i.Injectable)(),Gt("design:paramtypes",["function"==typeof(e="undefined"!=typeof St&&St)&&e||Object,"function"==typeof(o="undefined"!=typeof Bt&&Bt)&&o||Object])],t);var e,o}(),Nt=o("TO51"),Mt=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},Kt=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ut=function(){function t(t){var e=this;this.gridCache=t,this.subjectByCanvasId={},this.gridKeysByCanvasId={},this.canvasIdsByGidKey={},this.lastObservedKeysStr="",this.gridCache.observable.subscribe(function(t){return e.processGridUpdates(t)})}return t.prototype.isReady=function(){return this.gridCache.isReady()},t.prototype.unsubscribeCanvas=function(t){delete this.gridKeysByCanvasId[t],delete this.subjectByCanvasId[t],this.rebuildReverseLookup(),this.updateGridCacheWatchedKeys()},t.prototype.observableForCanvas=function(t){return j(!this.subjectByCanvasId.hasOwnProperty(t),"Canvas "+t+" has already requested a subhect"),this.subjectByCanvasId[t]=new Nt.Subject,this.subjectByCanvasId[t]},t.prototype.updateDiagramWatchedGrids=function(t,e){this.gridKeysByCanvasId[t]=e,this.rebuildReverseLookup(),this.updateGridCacheWatchedKeys()},t.prototype.processGridUpdates=function(t){if(this.canvasIdsByGidKey.hasOwnProperty(t.gridKey))for(var e=0,o=this.canvasIdsByGidKey[t.gridKey];e<o.length;e++){var n=o[e];this.subjectByCanvasId[n].next(t)}},t.prototype.updateGridCacheWatchedKeys=function(){var t=S(this.canvasIdsByGidKey).sort(),e=t.join(",");this.lastObservedKeysStr!=e&&(this.lastObservedKeysStr=e,this.gridCache.updateWatchedGrids(t))},t.prototype.rebuildReverseLookup=function(){for(var t={},e=0,o=S(this.gridKeysByCanvasId);e<o.length;e++)for(var n=o[e],i=0,r=this.gridKeysByCanvasId[n];i<r.length;i++){var s=r[i],c=null;t.hasOwnProperty(s)?c=t[s]:t[s]=c=[],c.push(n)}this.canvasIdsByGidKey=t},t=Mt([Object(i.Injectable)(),Kt("design:paramtypes",["function"==typeof(e="undefined"!=typeof Lt&&Lt)&&e||Object])],t);var e}(),Vt=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},zt=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ft=function(){function t(){this.modelSetKey=""}return t.prototype.setModelSetKey=function(t){this.modelSetKey=t},t.prototype.dispGroupForId=function(t){return[]},t=Vt([Object(i.Injectable)(),zt("design:paramtypes",[])],t)}(),Wt=function(){function t(e,o,n,i){if(void 0===e&&(e=0),void 0===o&&(o=0),void 0===n&&(n=0),void 0===i&&(i=0),e instanceof t)return this.x=parseFloat(e.x.toString()),this.y=parseFloat(e.y.toString()),this.w=parseFloat(e.w.toString()),void(this.h=parseFloat(e.h.toString()));this.x=0,this.y=0,this.w=0,this.h=0,e&&(this.x=parseFloat(e.toString())),o&&(this.y=parseFloat(o.toString())),n&&(this.w=parseFloat(n.toString())),i&&(this.h=parseFloat(i.toString())),this.w<0&&(this.w*=-1,this.x=this.x-this.w),this.h<0&&(this.h*=-1,this.y=this.y-this.h)}return t.fromGeom=function(e){for(var o=new t,n=e[0],i=e[1],r=n,s=n,c=i,a=i,l=2;l<e.length;l+=2){var u=e[l],f=e[l+1];u<r&&(r=u),s<u&&(s=u),f<c&&(c=f),a<f&&(a=f)}return o.x=r,o.y=c,o.w=s-r,o.h=a-c,o},t.prototype.contains=function(t,e,o){var n=this,i=n.x-o/2,r=n.x+n.w+o/2,s=n.y-o/2,c=n.y+n.h+o/2;return i<=t&&t<=r&&s<=e&&e<=c},t.prototype.withIn=function(e,o,n,i){e instanceof t&&(o=e.y,n=e.w,i=e.h,e=e.x);var r=this;return e<=r.x&&r.x+r.w<=e+n&&o<=r.y&&r.y+r.h<=o+i},t.prototype.isEqual=function(e){return e instanceof t&&(this.x===e.x&&this.y===e.y&&this.w===e.w&&this.h===e.h)},t.prototype.area=function(){return this.w*this.h},t.prototype.toString=function(){return this.x+"x,"+this.y+"y,"+this.w+"w,"+this.h+"h"},t}(),Zt=function(){function t(){this.controller={updateInterval:400,coordSetChange:new f.Subject,coordSet:null},this.renderer={invalidate:new f.Subject,drawInterval:60,backgroundColor:"black",selection:{color:"white",width:8,lineGap:6,dashLen:3,snapSize:4},grid:{show:!1,size:16,color:"#CCC",font:"12px Arial",lineWidth:1,snapDashedLen:2}},this.viewPort={windowChange:new f.Subject,window:new Wt,zoomChange:new f.Subject,panChange:new f.Subject,pan:{x:238255,y:124655},zoom:.5,minZoom:.01,maxZoom:10},this.canvas={windowChange:new f.Subject,window:new Wt},this.mouse={currentDelegateName:null,phUpDownZoomFactor:20,currentViewPortPosition:{x:0,y:0},currentCanvasPosition:{x:0,y:0},selecting:{color:"#3399FF",width:2,lineGap:2,dashLen:3,snapSize:4,margin:5}},this.model={gridsWaitingForData:0,dispOnScreen:0},this.debug={},this.canvasId=t.canvasIdCounter++}return t.prototype.invalidate=function(){this.renderer.invalidate.next()},t.prototype.updateViewPortPan=function(t){this.viewPort.pan=t,this.viewPort.panChange.next(t)},t.prototype.updateViewPortZoom=function(t){this.viewPort.zoom=t,this.viewPort.zoomChange.next(t)},t.prototype.updateViewPortWindow=function(t){this.viewPort.window=t,this.viewPort.windowChange.next(t)},t.prototype.updateCanvasWindow=function(t){this.canvas.window=t,this.canvas.windowChange.next(t)},t.prototype.updateCoordSet=function(t){this.controller.coordSet=t,this.controller.coordSetChange.next(t),this.viewPort.minZoom=t.minZoom,this.viewPort.maxZoom=t.maxZoom},t.canvasIdCounter=0,t}(),Ht=function(){return function(t){this.config=t}}(),Yt=function(){function t(){}return t.id=function(t){return t.id},t.level=function(t){return t.lel},t.layer=function(t){return t.lal},t.isSelectable=function(t){return t.s},t.key=function(t){return t.k},t.data=function(t){return null==t.d?{}:JSON.parse(t.d)},t}(),Xt=this&&this.__extends||(k=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}k(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});(A=G||(G={}))[A.fillTopToBottom=0]="fillTopToBottom",A[A.fillBottomToTop=1]="fillBottomToTop",A[A.fillRightToLeft=2]="fillRightToLeft",A[A.fillLeftToRight=3]="fillLeftToRight";var Qt,Jt,qt,$t,te,ee,oe=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Xt(e,t),e.fillColor=function(t){return t.fcl},e.lineColor=function(t){return t.lcl},e.lineStyle=function(t){return t.lsl},e.cornerRadius=function(t){return t.cr},e.lineWidth=function(t){return t.w},e.geom=function(t){return t.g},e.fillDirection=function(t){var e=t.fd;return e==G.fillBottomToTop?G.fillBottomToTop:e==G.fillRightToLeft?G.fillRightToLeft:e==G.fillLeftToRight?G.fillLeftToRight:G.fillTopToBottom},e.fillPercent=function(t){return t.fp},e}(Yt),ne=this&&this.__extends||(Qt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}Qt(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),ie=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ne(e,t),e.fillColor=function(t){return t.fcl},e.lineColor=function(t){return t.lcl},e.lineStyle=function(t){return t.lsl},e.lineWidth=function(t){return t.w},e.centerPointX=function(t){return t.g[0]},e.centerPointY=function(t){return t.g[1]},e.xRadius=function(t){return t.xr},e.yRadius=function(t){return t.yr},e.rotation=function(t){return t.r},e.startAngle=function(t){return t.sa},e.endAngle=function(t){return t.ea},e}(Yt),re=this&&this.__extends||(Jt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}Jt(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});($t=qt||(qt={}))[$t.top=-1]="top",$t[$t.center=0]="center",$t[$t.bottom=1]="bottom",(ee=te||(te={}))[ee.left=-1]="left",ee[ee.center=0]="center",ee[ee.right=1]="right";var se,ce,ae,le,ue,fe=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return re(e,t),e.textStyle=function(t){return t.fsl},e.color=function(t){return t.cl},e.verticalAlign=function(t){var e=t.va;return e==qt.top?qt.top:e==qt.bottom?qt.bottom:qt.center},e.horizontalAlign=function(t){var e=t.ha;return e==te.left?te.left:e==te.right?te.right:te.center},e.rotation=function(t){return t.r},e.text=function(t){return t.te},e.height=function(t){return t.th},e.horizontalStretch=function(t){return t.hs},e.centerPointX=function(t){return t.g[0]},e.centerPointY=function(t){return t.g[1]},e}(Yt),pe=this&&this.__extends||(se=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}se(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),de=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return pe(e,t),e.lineColor=function(t){return t.lcl},e.lineStyle=function(t){return t.lsl},e.lineWidth=function(t){return t.w},e.geom=function(t){return t.g},e.startKey=function(t){return t.sk},e.endKey=function(t){return t.ek},e}(Yt),he=this&&this.__extends||(ce=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}ce(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),ye=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return he(e,t),e}(Yt),ve=this&&this.__extends||(ae=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}ae(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),_e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ve(e,t),e.items=function(t){return t.items},e}(Yt);(ue=le||(le={}))[ue.ellipse=0]="ellipse",ue[ue.polygon=1]="polygon",ue[ue.polyline=2]="polyline",ue[ue.text=3]="text",ue[ue.group=4]="group",ue[ue.groupPointer=5]="groupPointer";var ge,be,me,Se,we,Oe=function(){function t(){}return t.type=function(e){return t.typeMap[e._tt][0]},t.wrapper=function(e){return t.typeMap[e._tt][1]},t.typeMap={DT:[le.text,fe],DPG:[le.polygon,oe],DPL:[le.polyline,de],DE:[le.ellipse,ie],DG:[le.group,_e],DGP:[le.groupPointer,ye]},t}(),je=this&&this.__extends||(ge=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}ge(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),Pe=function(t){function e(e){return t.call(this,e)||this}return je(e,t),e.prototype._drawLine=function(t,e,o,n,i,r,s,c){if(null!=r){var a=r[c%r.length]/s;t.moveTo(e,o);for(var l=n-e,u=i-o,f=Math.floor(Math.sqrt(l*l+u*u)/a),p=l/f,d=u/f,h=0;h++<f;)e+=p,o+=d,t[h%2==0?"moveTo":"lineTo"](e,o);t[h%2==0?"moveTo":"lineTo"](n,i)}else t.lineTo(n,i)},e.prototype.draw=function(t,e,o,n){var i=Oe.type(t)==le.polygon,r=i?oe.fillColor(t):null,s=oe.lineColor(t),c=oe.lineStyle(t),a=null;if(null!=c&&null!=c.dashPattern&&(a=c.dashPattern),r=r&&r.color?r:null,s=c&&s&&s.color?s:null,r||s){var l=oe.fillDirection(t),u=oe.fillPercent(t),f=oe.geom(t),p=f[0],d=f[1];if(s&&c.backgroundFillDashSpace&&a){e.beginPath(),e.moveTo(p,d);for(var h=2;h<f.length;h+=2){var y=f[h],v=f[h+1];e.lineTo(y,v)}e.strokeStyle=this.config.renderer.backgroundColor,e.lineWidth=oe.lineWidth(t)/o,e.stroke()}e.beginPath(),e.moveTo(p,d);var _=p,g=d;for(h=2;h<f.length;h+=2){y=f[h],v=f[h+1];this._drawLine(e,_,g,y,v,a,o,h),_=y,g=v}i&&e.closePath(),s&&(e.strokeStyle=s.color,e.lineWidth=oe.lineWidth(t)/o,e.stroke()),r&&(i&&null!=l&&null!=u?this._drawSquarePercentFill(e,Wt.fromGeom(f),r,l,u):(e.fillStyle=r.color,e.fill()))}},e.prototype._drawSquarePercentFill=function(t,e,o,n,i){if(0==n)e.h*=i/100;else if(1==n){var r=e.h;e.h*=i/100,e.y+=r-e.h}else if(2==n){var s=e.w;e.w*=i/100,e.x+=s-e.w}else 3==n&&(e.w*=i/100);t.fillStyle=o.color,t.fillRect(e.x,e.y,e.w,e.h)},e.prototype.drawSelected=function(t,e,o,n){var i=oe.geom(t),r=this.config.renderer.selection,s=Wt.fromGeom(i),c=(r.width+r.lineGap)/o,a=2*c,l=s.x-c,u=s.y-c,f=s.w+a,p=s.h+a;e.dashedRect(l,u,f,p,r.dashLen/o),e.strokeStyle=r.color,e.lineWidth=r.width/o,e.stroke()},e.prototype.contains=function(t,e,o,n){var i=oe.geom(t);return!!Wt.fromGeom(i).contains(e,o,n)&&(Oe.type(t)==le.polygon?this.polygonContains(i,t,e,o,n):this.polylineContains(i,t,e,o,n))},e.prototype.polygonContains=function(t,e,o,n,i){for(var r,s,c,a,l,u,f,p,d,h=0,y=t[0],v=t[1],_=y,g=v,b=2;b<=t.length;b+=2){var m=y,S=v;b!=t.length&&(m=t[b],S=t[b+1]),r=_,c=m,void 0,void 0,void 0,void 0,void 0,u=(l=(s=g)>(a=S))?c:r,f=l?a:s,p=l?r:c,d=l?s:a,n!=f&&n!=d||(n+=1e-8),n>d||n<f||o>Math.max(u,p)||!(o<Math.min(u,p)||(u!=o?(n-f)/(o-u):1/0)>=(u!=p?(d-f)/(p-u):1/0))||h++,_=m,g=S}return h%2==1},e.prototype.xxx=function(){return!1},e.prototype.polylineContains=function(t,e,o,n,i){for(var r=t[0],s=t[1],c=2;c<t.length;c+=2){var a=t[c],l=t[c+1],u=a-r,f=l-s,p=(r<a?r:a)-i,d=(r<a?a:r)+i,h=(s<l?s:l)-i,y=(s<l?l:s)+i;if(0==u&&p<=o&&o<=d&&h<=n&&n<=y)return!0;var v=f/u,_=s-v*r,g=v*o+_,b=(n-_)/v;if((n-i<g&&g<n+i||o-i<b&&b<o+i)&&p<=o&&o<=d&&h<=n&&n<=y)return!0;r=a,s=l}return!1},e.prototype.withIn=function(t,e,o,n,i){return!1},e.prototype.handles=function(t){return[]},e.prototype.deltaMove=function(t,e,o){},e.prototype.area=function(t){return 0},e}(Ht),xe=this&&this.__extends||(be=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}be(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),Re=function(t){function e(e){return t.call(this,e)||this}return xe(e,t),e.prototype.draw=function(t,e,o,n){var i=fe.rotation(t)/180*Math.PI,r=fe.textStyle(t),s=fe.color(t);s=s&&s.color?s:null;var c=fe.horizontalStretch(t),a=fe.height(t),l=r.fontSize*r.scaleFactor;null!=a&&(l=a);var u=l+"px "+r.fontName+" "+(r.fontStyle||""),f=96*l/72,p=null,d=fe.horizontalAlign(t);d==te.left?p="start":d==te.center?p="center":d==te.right&&(p="end");var h=null,y=fe.verticalAlign(t);if(y==qt.top?h="top":y==qt.center?h="middle":y==qt.bottom&&(h="bottom"),e.save(),e.translate(fe.centerPointX(t),fe.centerPointY(t)),e.rotate(i),e.textAlign=p,e.textBaseline=h,e.font=u,!r.scalable){var v=1/o;e.scale(v,v)}1!=c&&e.scale(c,1);for(var _=fe.text(t).split("\n"),g=0;g<_.length;++g){var b=_[g],m=f*g;s&&(e.fillStyle=s.color,e.fillText(b,0,m))}e.restore()},e.prototype.drawSelected=function(t,e,o,n){},e.prototype.contains=function(t,e,o,n){return!1},e.prototype.withIn=function(t,e,o,n,i){return!1},e.prototype.handles=function(t){return[]},e.prototype.deltaMove=function(t,e,o){},e.prototype.area=function(t){return 0},e}(Ht),Te=this&&this.__extends||(me=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}me(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),De=function(t){function e(e){return t.call(this,e)||this}return Te(e,t),e.prototype.draw=function(t,e,o){var n=ie.fillColor(t),i=ie.lineColor(t);n=n&&n.color?n:null,i=i&&i.color?i:null;var r=ie.xRadius(t),s=ie.yRadius(t),c=ie.rotation(t)/180*Math.PI,a=ie.startAngle(t),l=ie.endAngle(t),u=ie.lineWidth(t),f=s/r;e.save(),e.translate(ie.centerPointX(t),ie.centerPointY(t)),e.scale(1,f),e.rotate(c);var p=a/180*Math.PI,d=l/180*Math.PI;e.beginPath(),e.arc(0,0,r,p,d,!0),n&&(e.lineTo(0,0),e.fillStyle=n.color,e.fill()),i&&(e.strokeStyle=i.color,e.lineWidth=u/o,e.stroke()),e.restore()},e.prototype.drawSelected=function(t,e,o){},e.prototype.contains=function(t,e,o,n){return!1},e.prototype.withIn=function(t,e,o,n,i){return!1},e.prototype.handles=function(t){return[]},e.prototype.deltaMove=function(t,e,o){},e.prototype.area=function(t){return t.bounds.area()},e}(Ht),Ce=this&&this.__extends||(Se=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}Se(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),Ee=function(t){function e(e){return t.call(this,e)||this}return Ce(e,t),e.prototype.draw=function(t,e,o,n){},e.prototype.drawSelected=function(t,e,o,n){var i=this.config.renderer.selection,r=t.bounds,s=(i.width+i.lineGap)/o,c=2*s,a=r.x-s,l=r.y-s,u=r.w+c,f=r.h+c;e.dashedRect(a,l,u,f,i.dashLen/o),e.strokeStyle=i.color,e.lineWidth=i.width/o,e.stroke()},e.prototype.contains=function(t,e,o,n){return t.bounds.contains(e,o,n)},e.prototype.withIn=function(t,e,o,n,i){return t.bounds.withIn(e,o,n,i)},e.prototype.handles=function(t){return[]},e.prototype.deltaMove=function(t,e,o){},e.prototype.area=function(t){return t.bounds.area()},e}(Ht),Ie=this&&this.__extends||(we=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}we(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),Be=function(t){function e(e,o,n){var i=t.call(this,e)||this;return i.renderFactory=o,i.dispGroupCache=n,i}return Ie(e,t),e.prototype.draw=function(t,e,o,n){var i=this.dispGroupCache.dispGroupForId(t.gid);if(null!=i){var r=t.g[0],s=t.g[1],c=t.r/180*Math.PI,a=t.vs,l=t.hs;e.save(),e.translate(r,s),e.rotate(c),e.scale(a,l);for(var u=0;u<i.length;u++){var f=i[u];this.renderFactory.draw(f,e,o,n)}e.restore()}},e.prototype.drawSelected=function(t,e,o,n){},e.prototype.contains=function(t,e,o,n){return!1},e.prototype.withIn=function(t,e,o,n,i){return!1},e.prototype.handles=function(t){return[]},e.prototype.deltaMove=function(t,e,o){},e.prototype.area=function(t){return 0},e}(Ht),ke=function(){function t(t,e){var o=new Pe(t),n=new Re(t),i=new De(t),r=new Ee(t),s=new Be(t,this,e);this._delegatesByType={DT:n,DPG:o,DPL:o,DE:i,DA:r,DGP:s}}return t.prototype._initBounds=function(t){null==t.bounds&&(t.bounds=Wt.fromGeom(t.g))},t.prototype.draw=function(t,e,o,n){var i=Yt.level(t);i.minZoom<=o&&o<=i.maxZoom&&(null==this._delegatesByType[t._tt]&&console.log(t._tt),this._delegatesByType[t._tt].draw(t,e,o,n))},t.prototype.drawSelected=function(t,e,o,n){this._delegatesByType[t._tt].drawSelected(t,e,o,n)},t.prototype.contains=function(t,e,o,n){return this._initBounds(t),this._delegatesByType[t._tt].contains(t,e,o,n)},t.prototype.withIn=function(t,e,o,n,i){return this._initBounds(t),this._delegatesByType[t._tt].withIn(t,e,o,n,i)},t.prototype.similarTo=function(t,e){return!1},t.prototype.handles=function(t){return this._delegatesByType[t._tt].handles(t)},t.prototype.deltaMove=function(t,e,o){return this._initBounds(t),this._delegatesByType[t._tt].deltaMove(e,o)},t.prototype.area=function(t){return this._initBounds(t),this._delegatesByType[t._tt].area(t)},t.prototype.selectionPriotityCompare=function(t,e){return Oe.type(t)==le.polygon&&Oe.type(e)!=le.polygon?1:this._delegatesByType[e._tt].area()-this._delegatesByType[t._tt].area()},t}(),Ge=function(){return function(){this.x=0,this.y=0}}(),Ae=function(){function t(t,e,o,n){this.config=t,this.model=e,this.dispDelegate=o,this.lifecycleEventEmitter=n,this.canvas=null,this.isValid=!1,this.drawEvent=new Nt.Subject,this._zoom=1,this._pan=new Ge}return t.prototype.invalidate=function(){this.isValid=!1},t.prototype.setCanvas=function(t){this.canvas=t,this._init()},t.prototype._init=function(){var t=this;setInterval(function(){return t.draw()},this.config.renderer.drawInterval),this.config.viewPort.zoomChange.takeUntil(this.lifecycleEventEmitter.onDestroyEvent).subscribe(function(e){e!=t._zoom&&t.zoom(e/t._zoom)}),this.config.viewPort.panChange.takeUntil(this.lifecycleEventEmitter.onDestroyEvent).subscribe(function(){return t.pan()}),this.config.canvas.windowChange.takeUntil(this.lifecycleEventEmitter.onDestroyEvent).subscribe(function(){return t.invalidate()}),this.config.renderer.invalidate.takeUntil(this.lifecycleEventEmitter.onDestroyEvent).subscribe(function(){return t.invalidate()})},t.prototype.currentViewArea=function(){var t={w:this.canvas.clientWidth/this._zoom,h:this.canvas.clientHeight/this._zoom};return new Wt(this._pan.x-t.w/2,this._pan.y-t.h/2,t.w,t.h)},t.prototype.zoom=function(t){this._zoom*t<this.config.viewPort.minZoom?t=this.config.viewPort.minZoom/this._zoom:this._zoom*t>this.config.viewPort.maxZoom&&(t=this.config.viewPort.maxZoom/this._zoom),this._zoom*=t,this.config.viewPort.zoom=this._zoom,this.config.updateViewPortWindow(this.currentViewArea()),this.invalidate()},t.prototype.pan=function(){var t=this.config.viewPort.pan;this._pan.x=t.x,this._pan.y=t.y,this.config.updateViewPortWindow(this.currentViewArea()),this.invalidate()},t.prototype.draw=function(){if(!this.isValid){this.isValid=!0;var t=this.canvas.getContext("2d"),e=this.model.viewableDisps(),o=this.model.selectedDisps(),n=this.canvas.width/this._zoom,i=this.canvas.height/this._zoom;t.save(),t.translate(this.canvas.width/2,this.canvas.height/2),t.scale(this._zoom,this._zoom),t.translate(-this._pan.x,-this._pan.y),t.fillStyle=this.config.renderer.backgroundColor,t.fillRect(this._pan.x-n,this._pan.y-i,2*n,2*i),this._drawGrid(t);for(var r=0;r<e.length;r++){var s=e[r];this.dispDelegate.draw(s,t,this._zoom,this._pan)}for(r=0;r<o.length;r++){s=o[r];this.dispDelegate.drawSelected(s,t,this._zoom,this._pan)}this.drawEvent.next(t),t.restore()}},t.prototype._drawGrid=function(t){function e(t){return parseInt(t)}if(this.config.renderer.grid.show){var o=this.config.viewPort.window,n=this.config.viewPort.zoom,i=1/n,r=this.config.controller.coordSet.gridSizeForZoom(n),s=o.x,c=o.y,a=o.x+o.w,l=o.y+o.h,u=e(s/r.xGrid),f=e(a/r.xGrid)+1,p=e(c/r.yGrid),d=e(l/r.yGrid)+1;t.lineWidth=this.config.renderer.grid.lineWidth/this._zoom,t.strokeStyle=this.config.renderer.grid.color,t.fillStyle=this.config.renderer.grid.color,t.textAlign="start",t.textBaseline="top",t.font=this.config.renderer.grid.font;for(var h=u;h<f;h++)t.beginPath(),t.moveTo(h*r.xGrid,c),t.lineTo(h*r.xGrid,l),t.stroke();for(var y=p;y<d;y++)t.beginPath(),t.moveTo(s,y*r.yGrid),t.lineTo(a,y*r.yGrid),t.stroke();for(h=u;h<f;h++)for(y=p;y<d;y++){var v=h.toString()+"x"+y.toString();t.save(),t.translate(h*r.xGrid+15,y*r.yGrid+15),t.scale(i,i),t.fillText(v,0,0),t.restore()}}},t.prototype.canvasInnerBounds=function(){var t=this.canvas;return new Wt(0,0,t.width,t.height)},t}(),Le=o("S4Bb"),Ne=function(){return function(){this.x=0,this.y=0,this.clientX=0,this.clientY=0}}();function Me(t){return t.preventDefault(),!1}var Ke,Ue=function(){function t(t){this.NAME=t,this._CanvasInput=null,this._lastMousePos=new Ne,this.DRAG_START_THRESHOLD=5,this.DRAG_TIME_THRESHOLD=200}return t.prototype._hasPassedDragThreshold=function(t,e){var o=!1;return o=(o=(o=o||e.time.getTime()-t.time.getTime()>this.DRAG_TIME_THRESHOLD)||Math.abs(t.x-e.x)>this.DRAG_START_THRESHOLD)||Math.abs(t.y-e.y)>this.DRAG_START_THRESHOLD},t.prototype.keyDown=function(t){},t.prototype.keyPress=function(t){},t.prototype.keyUp=function(t){},t.prototype.mouseSelectStart=function(t,e){},t.prototype.mouseDown=function(t,e){},t.prototype.mouseMove=function(t,e){},t.prototype.mouseUp=function(t,e){},t.prototype.mouseDoubleClick=function(t,e){},t.prototype.mouseWheel=function(t,e){},t.prototype.touchStart=function(t,e){},t.prototype.touchMove=function(t,e){},t.prototype.touchEnd=function(t,e){},t.prototype.shutdown=function(){},t.prototype.draw=function(t){},t.prototype._setLastMousePos=function(t){var e=t.x-this._lastMousePos.x,o=t.y-this._lastMousePos.y,n=t.clientX-this._lastMousePos.clientX,i=t.clientY-this._lastMousePos.clientY;return this._lastMousePos.x+=e,this._lastMousePos.y+=o,this._lastMousePos.clientX+=n,this._lastMousePos.clientY+=i,{dx:e,dy:o,dClientX:n,dClientY:i}},t}(),Ve=o("iw1t"),ze=this&&this.__extends||(Ke=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}Ke(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),Fe=function(t){function e(o,n,i,r){var s=t.call(this,e.TOOL_NAME)||this;return s.canvasInput=o,s.config=n,s.model=i,s.dispDelegate=r,s.STATE_NONE=0,s.STATE_SELECTING=1,s.STATE_DRAG_SELECTING=2,s.STATE_MOVING_RENDERABLE=3,s.STATE_MOVING_HANDLE=4,s.STATE_CANVAS_PANNING=5,s.STATE_CANVAS_ZOOMING=6,s._state=0,s._passedDragThreshold=!1,s._mouseDownOnSelection=!1,s._mouseDownOnCoord=!1,s._mouseDownWithShift=!1,s._mouseDownWithCtrl=!1,s._mouseDownMiddleButton=!1,s._mouseDownRightButton=!1,s._mouseDownOnHandle=null,s._lastPinchDist=null,s._startMousePos=null,s._reset(),s}return ze(e,t),e.prototype._reset=function(){this._state=this.STATE_NONE,this._passedDragThreshold=!1,this._mouseDownOnSelection=!1,this._mouseDownOnCoord=!1,this._mouseDownWithShift=!1,this._mouseDownWithCtrl=!1,this._mouseDownMiddleButton=!1,this._mouseDownRightButton=!1,this._mouseDownOnHandle=null,this._lastPinchDist=null,this._startMousePos=null,this._lastMousePos=null},e.prototype.keyUp=function(t){var e=this.config.mouse.phUpDownZoomFactor;if(46==t.keyCode);else if(33==t.keyCode){var o=this.config.viewPort.zoom;o*=1+e/100,this.config.updateViewPortZoom(o)}else if(34==t.keyCode){o=this.config.viewPort.zoom;o*=1-e/100,this.config.updateViewPortZoom(o)}},e.prototype.touchStart=function(t,e){2==t.targetTouches.length?(this._state=this.STATE_CANVAS_ZOOMING,this._lastPinchDist=null):this.mouseDown(t,e)},e.prototype.mouseDown=function(t,e){if(this._mouseDownWithShift=t.shiftKey,this._mouseDownWithCtrl=t.ctrlKey,this._mouseDownMiddleButton=1==t.button,this._mouseDownRightButton=2==t.button,this._startMousePos=e,this._lastMousePos=e,this._mouseDownMiddleButton||this._mouseDownRightButton)this._state=this.STATE_CANVAS_PANNING;else{for(var o=this.model.selectedDisps(),n=o.length-1;n>=0;n--)for(var i=o[n],r=this.dispDelegate.handles(i),s=0;s<r.length;s++){var c=r[s];if(c.contains(e.x,e.y)){this._mouseDownOnHandle={coord:i,handle:c,handleIndex:s};break}}var a=this.config.mouse.selecting.margin;for(n=o.length-1;n>=0;n--){var l=o[n];if(this.dispDelegate.contains(l,e.x,e.y,a)){this._mouseDownOnSelection=!0;break}}if(this._mouseDownOnSelection)this._mouseDownOnCoord=!0;else{var u=this.model.selectableDisps();for(n=u.length-1;n>=0;n--){l=u[n];if(this.dispDelegate.contains(l,e.x,e.y,a)){this._mouseDownOnCoord=!0;break}}}this._mouseDownOnCoord?this._state=this.STATE_SELECTING:(this._state=this.STATE_CANVAS_PANNING,this.model.clearSelection())}},e.prototype.touchMove=function(t,e){this._state==this.STATE_CANVAS_ZOOMING?this._touchZoom(t,e):this.mouseMove(t,e),t.preventDefault()},e.prototype._touchZoom=function(t,e){var o=t.targetTouches[0].pageX,n=t.targetTouches[0].pageY,i=t.targetTouches[1].pageX,r=t.targetTouches[1].pageY,s={clientX:e.clientX,clientY:e.clientY};console.log(s);var c=Math.sqrt((o-i)*(o-i)+(n-r)*(n-r));if(null!=this._lastPinchDist){var a=this._lastPinchDist-c;this._lastPinchDist=c,this._zoomPan(s.clientX,s.clientY,a)}else this._lastPinchDist=c},e.prototype._zoomPan=function(t,e,o){if(o){o*=-1;var n=this.config.viewPort.zoom,i=this.config.viewPort.pan,r=t/n+i.x,s=e/n+i.y;if(n*=1+o/100,this.config.viewPort.minZoom<n&&n<this.config.viewPort.maxZoom){var c=t/n+i.x,a=e/n+i.y,l={x:i.x+(r-c),y:i.y+(s-a)};this.config.updateViewPortPan(l),this.config.updateViewPortZoom(n)}}},e.prototype.mouseMove=function(t,e){if(this._state!=this.STATE_NONE){switch(this._passedDragThreshold=this._passedDragThreshold||this._hasPassedDragThreshold(this._startMousePos,e),this._state==this.STATE_SELECTING&&this._passedDragThreshold&&(this._mouseDownOnSelection?this._state=this.STATE_MOVING_RENDERABLE:this._mouseDownOnCoord?(this._changeSelection(this._selectByPoint(this._startMousePos)),this._state=this.STATE_MOVING_RENDERABLE):this._state=this.STATE_DRAG_SELECTING),this._state){case this.STATE_CANVAS_PANNING:var o=this._setLastMousePos(e),n=this.config.viewPort.pan,i={x:n.x-o.dClientX/this.config.viewPort.zoom,y:n.y-o.dClientY/this.config.viewPort.zoom};this.config.updateViewPortPan(i);break;case this.STATE_DRAG_SELECTING:this._lastMousePos=e;break;case this.STATE_MOVING_RENDERABLE:case this.STATE_MOVING_HANDLE:for(var r=this.model.selectedDisps(),s=(o=this._setLastMousePos(e),r.length-1);s>=0;--s)this.dispDelegate.deltaMove(r[s],o.dx,o.dy);if(0!=r.length){this.config.invalidate();break}if(this._state==this.STATE_MOVING_HANDLE){var c=this._setLastMousePos(e),a=this._mouseDownOnHandle;Ve(null!=a,"selected handler is null"),a.coord.deltaMoveHandle(c.dx,c.dy,a.handle,a.handleIndex)}}this.config.invalidate()}},e.prototype.touchEnd=function(t,e){this.mouseUp(t,e)},e.prototype.mouseUp=function(t,e){switch(this._state){case this.STATE_SELECTING:case this.STATE_DRAG_SELECTING:var o=[];this._state==this.STATE_SELECTING?o=this._selectByPoint(this._startMousePos):this._state==this.STATE_DRAG_SELECTING?o=this._selectByBox(this._startMousePos,e):Ve(!1,"Invalid state"),this._changeSelection(o);break;case this.STATE_MOVING_RENDERABLE:case this.STATE_MOVING_HANDLE:for(var n=this.model.selectedDisps().length-1;n>=0;n--)console.log("TODO, Store node move states");console.log("TODO, this.canvasInput._notifyOfChange")}this._reset(),this.config.invalidate()},e.prototype.mouseDoubleClick=function(t,e){var o=this._selectByTypeAndBounds(e);this.model.addSelection(o)},e.prototype.mouseWheel=function(t,e){var o=t.deltaY||t.wheelDelta;15<o&&(o=15),o<-15&&(o=-15),this._zoomPan(e.clientX,e.clientY,o)},e.prototype.draw=function(t){switch(this._state){case this.STATE_DRAG_SELECTING:var e=this.config.viewPort.zoom,o=this._startMousePos.x,n=this._startMousePos.y,i=this._lastMousePos.x-this._startMousePos.x,r=this._lastMousePos.y-this._startMousePos.y;t.strokeStyle=this.config.mouse.selecting.color,t.lineWidth=this.config.mouse.selecting.width/e,t.dashedRect(o,n,i,r,this.config.mouse.selecting.dashLen/e),t.stroke();break;case this.STATE_NONE:}},e.prototype._selectByPoint=function(t){var e=this,o=this.config.mouse.selecting.margin,n=this.model.selectableDisps().filter(function(n){return e.dispDelegate.contains(n,t.x,t.y,o)},this);return n.sort(function(t,o){return e.dispDelegate.selectionPriotityCompare(t,o)}),!this._mouseDownWithCtrl&&n.length&&(n=[n[n.length-1]]),n},e.prototype._selectByBox=function(t,e){var o=this,n=this.model.selectableDisps(),i=Wt.fromGeom([t,e]);return n.filter(function(t){return o.dispDelegate.withIn(t,i.x,i.y,i.w,i.h)})},e.prototype._selectByTypeAndBounds=function(t){var e=this,o=this._selectByPoint(t);if(!o.length)return[];var n=o[o.length-1];return this.model.selectableDisps().filter(function(t){return e.dispDelegate.similarTo(t,n)})},e.prototype._changeSelection=function(t){this._mouseDownOnSelection&&this._mouseDownWithShift?this.model.removeSelection(t):(this._mouseDownWithShift||this.model.clearSelection(),this.model.addSelection(t))},e}(Ue),We=function(){function t(t,e,o,n){this.config=t,this.model=e,this.dispDelegate=o,this.lifecycleEventEmitter=n,this._delegate=null,this.canvas=null,this.mouseOffsetX=0,this.mouseOffsetY=0,this.delegateFinished()}return t.prototype.setDelegate=function(t){this._delegate&&this._delegate.shutdown(),this._delegate=new t(this,this.config,this.model,this.dispDelegate),this.config.mouse.currentDelegateName=this._delegate.NAME},t.prototype.delegateFinished=function(){this.setDelegate(Fe)},t.prototype._getMouse=function(t){var e=t.pageX,o=t.pageY;if(null==e)if(null!=t.changedTouches&&t.changedTouches.length>=0){var n=t.changedTouches[0];e=n.pageX,o=n.pageY}else console.log("ERROR: Failed to determine pan coordinates");var i=e-this.mouseOffsetX,r=o-this.mouseOffsetY,s=i,c=r,a=this.config.viewPort.zoom,l=this.config.viewPort.pan;return i=i/a+l.x,r=r/a+l.y,isNaN(i)&&console.log("mx IS NaN"),this.config.mouse.currentViewPortPosition={x:i,y:r},this.config.mouse.currentCanvasPosition={x:s,y:c},{x:i,y:r,clientX:s,clientY:c,time:new Date}},t.prototype.setCanvas=function(t){var e=this;this.canvas=t,t.addEventListener("keydown",function(t){e._delegate.keyDown(t)},!0),t.addEventListener("keypress",function(t){e._delegate.keyPress(t)},!0),t.addEventListener("keyup",function(t){e._delegate.keyUp(t)},!0),t.addEventListener("mousedown",function(t){t instanceof MouseEvent&&e._delegate.mouseDown(t,e._getMouse(t))},!0),t.addEventListener("mousemove",function(t){t instanceof MouseEvent&&e._delegate.mouseMove(t,e._getMouse(t))},!0),t.addEventListener("mouseup",function(t){t instanceof MouseEvent&&e._delegate.mouseUp(t,e._getMouse(t))},!0),t.addEventListener("mousewheel",function(t){if(t instanceof MouseEvent)return e._delegate.mouseWheel(t,e._getMouse(t)),t.preventDefault(),!1},!0),t.addEventListener("dblclick",function(t){t instanceof MouseEvent&&e._delegate.mouseDoubleClick(t,e._getMouse(t))},!0),t.addEventListener("selectstart",function(t){return t.preventDefault(),!1},!0),t.addEventListener("contextmenu",Me,!0),t.addEventListener("touchstart",function(t){t instanceof TouchEvent&&(e._delegate.touchStart(t,e._getMouse(t)),Me(t))},!0),t.addEventListener("touchmove",function(t){t instanceof TouchEvent&&(e._delegate.touchMove(t,e._getMouse(t)),Me(t))},!0),t.addEventListener("touchend",function(t){t instanceof TouchEvent&&(e._delegate.touchEnd(t,e._getMouse(t)),Me(t))},!0),this.config.canvas.windowChange.takeUntil(this.lifecycleEventEmitter.onDestroyEvent).subscribe(function(){return e.updateCanvasSize()})},t.prototype.updateCanvasSize=function(){var t=Le(this.canvas),e=this.canvas,o=t.width(),n=t.height(),i=parseInt(t.css("padding-left"))||0,r=parseInt(t.css("padding-top"))||0,s=parseInt(t.css("border-left-width"))||0,c=parseInt(t.css("border-top-width"))||0,a=document.body.parentNode,l=a.offsetTop,u=a.offsetLeft;if(this.mouseOffsetX=0,this.mouseOffsetY=0,null!=e.offsetParent)do{this.mouseOffsetX+=e.offsetLeft,this.mouseOffsetY+=e.offsetTop}while(e=e.offsetParent);this.mouseOffsetX+=i+s+u+o/2,this.mouseOffsetY+=r+c+l+n/2},t.prototype.draw=function(t){this._delegate&&this._delegate.draw(t)},t}();function Ze(){return new Date}var He,Ye,Xe,Qe,Je,qe,$e=function(){function t(t,e,o,n){var i=this;this.config=t,this.gridObservable=e,this.lookupCache=o,this.lifecycleEventEmitter=n,this._coordSetId=null,this._gridBuffer={},this._viewingGridKeysDict={},this._viewingGridKeysStr="",this._visableDisps=[],this._selection=[],this._selectionChangedSubject=new f.Subject,this.needsUpdate=!1,this.needsCompiling=!1,this.isUpdating=!1,this.needsUpdate=!1,setInterval(function(){return i._checkGridKeysForArea()},this.config.controller.updateInterval),setInterval(function(){return i._compileDisps()},this.config.controller.updateInterval),this.gridObservable.observableForCanvas(this.config.canvasId).takeUntil(this.lifecycleEventEmitter.onDestroyEvent).subscribe(function(t){return i._receiveGrid([t])}),this.lifecycleEventEmitter.onDestroyEvent.subscribe(function(){i.gridObservable.unsubscribeCanvas(i.config.canvasId)}),this.config.controller.coordSetChange.takeUntil(this.lifecycleEventEmitter.onDestroyEvent).subscribe(function(t){null==t?(i.config.updateViewPortPan({x:0,y:0}),i.config.updateViewPortZoom(1),i._coordSetId=null):(i.config.updateViewPortPan({x:t.initialPanX,y:t.initialPanY}),i.config.updateViewPortZoom(t.initialZoom),i._coordSetId=t.id),i.reset(),i.needsUpdate=!0}),this.config.viewPort.windowChange.takeUntil(this.lifecycleEventEmitter.onDestroyEvent).subscribe(function(){return i.needsUpdate=!0})}return t.prototype.selectionChangedObservable=function(){return this._selectionChangedSubject},t.prototype.reset=function(){this.needsUpdate=!1,this.isUpdating=!1,this._selection=[],this._visableDisps=[],this._gridBuffer={},this._viewingGridKeysDict={},this._viewingGridKeysStr=""},t.prototype._checkGridKeysForArea=function(){if(null!=this._coordSetId&&this.needsUpdate&&(this.needsUpdate=!1,this.lookupCache.isReady())){var t=this.config.viewPort.window,e=this.config.viewPort.zoom,o=this.config.controller.coordSet.gridKeysForArea(t,e);if(o.join()!=this._viewingGridKeysStr){this._viewingGridKeysStr=o.join(),this._viewingGridKeysDict=function(t){for(var e={},o=0;o<t.length;o++)e[t[o]]=!0;return e}(o);for(var n=0,i=S(this._gridBuffer);n<i.length;n++){var r=i[n];this._viewingGridKeysDict.hasOwnProperty(r)||delete this._gridBuffer[r]}this.gridObservable.updateDiagramWatchedGrids(this.config.canvasId,o)}}},t.prototype._receiveGrid=function(t){for(var e=0,o=t;e<o.length;e++){var n=o[e];if(console.log("PeekCanvasModel: Received grid "+n.gridKey+",  "+n.lastUpdate),n.hasData()&&this._viewingGridKeysDict.hasOwnProperty(n.gridKey)){var i=this._gridBuffer[n.gridKey];null!=i&&i.lastUpdate==n.lastUpdate||(console.log("PeekCanvasModel: Applying grid "+n.gridKey+",  "+n.lastUpdate),this._gridBuffer[n.gridKey]=n,this.needsCompiling=!0)}}},t.prototype.viewableDisps=function(){return this._visableDisps},t.prototype.selectableDisps=function(){return this.viewableDisps().filter(function(t){return Yt.isSelectable(t)})},t.prototype.selectedDisps=function(){return this._selection},t.prototype._compileDisps=function(){if(this.needsCompiling&&(this.needsCompiling=!1,null!=this._coordSetId)){for(var t=Ze(),e=this.lookupCache.levelsOrderedByOrder(this._coordSetId),o=this.lookupCache.layersOrderedByOrder(),n=(this.config.viewPort.zoom,{}),i=[],r={},s=S(this._viewingGridKeysDict),c=0;c<e.length;c++)for(var a=e[c],l=0;l<o.length;l++){var u=o[l];if(u.visible)for(var f=0;f<s.length;f++){var p=s[f],d=this._gridBuffer[p];if(null!=d){var h=n[p];if(null==h&&(h=0),!(h>=d.disps.length)){for(;h<d.disps.length;h++){var y=d.disps[h];if(!(Yt.level(y).order<a.order)){if(a.order<Yt.level(y).order)break;if(!(Yt.layer(y).order<u.order)){if(u.order<Yt.layer(y).order)break;!0!==r[y.id]&&(i.push(y),r[y.id]=!0)}}}n[p]=h}}}}this._visableDisps=i,this.config.model.dispOnScreen=i.length,this.config.invalidate();var v,_=Ze()-t;console.log((v=new Date).toTimeString().split(" ")[0]+"."+v.getUTCMilliseconds()+":  Model: compileDisps took "+_+"ms for "+i.length+" disps and "+s.length+" grids")}},t.prototype.addSelection=function(t){this._selection=this._selection.add(t),this.config.invalidate(),this._selectionChangedSubject.next(this._selection)},t.prototype.removeSelection=function(t){this._selection=this._selection.remove(t),this.config.invalidate(),this._selectionChangedSubject.next(this._selection)},t.prototype.clearSelection=function(){this._selection=[],this.config.invalidate(),this._selectionChangedSubject.next(this._selection)},t}(),to=this&&this.__extends||(He=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}He(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),eo=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},oo=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},no=function(t){function e(){return t.call(this,o.tupleName)||this}return to(e,t),o=e,e.prototype.gridSizeForZoom=function(t){if(null==t)throw new Error("Zoom can't be null");for(var e=0,o=this.gridSizes;e<o.length;e++){var n=o[e];if(n.min<=t&&t<n.max)return n}throw new Error("Unable to determine grid size for zoom "+t)},e.prototype.gridKeysForArea=function(t,e){function o(t){return parseInt(t)}for(var n=this.gridSizeForZoom(e),i=o(t.x/n.xGrid),r=o((t.x+t.w)/n.xGrid)+1,s=o(t.y/n.yGrid),c=o((t.y+t.h)/n.yGrid)+1,a=[],l=i;l<r;l++)for(var u=s;u<c;u++)a.push(this.id.toString()+"|"+n.key+"."+l+"x"+u);return a},e.tupleName=N+"ModelCoordSet",e=o=eo([c.addTupleType,oo("design:paramtypes",[])],e);var o}(c.Tuple),io=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},ro=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},so=function(){function t(t){this.tupleService=t,this.modelSetKey="",this._coordSetByKey={},this._coordSetById={},this.subscriptions=[],this._isReady=!1,this.initialLoad()}return t.prototype.initialLoad=function(){var t=this;this.subscriptions.push(this.tupleService.tupleOfflineObserver.subscribeToTupleSelector(new c.TupleSelector(no.tupleName,{})).subscribe(function(e){t._coordSetByKey={};for(var o=0,n=e;o<n.length;o++){var i=n[o];t._coordSetByKey[i.key]=i,t._coordSetById[i.id]=i}}))},t.prototype.shutdown=function(){for(var t=0,e=this.subscriptions;t<e.length;t++){e[t].unsubscribe()}this.subscriptions=[]},t.prototype.isReady=function(){if(this._isReady)return!0;var t=0;for(var e in this._coordSetByKey)t++;return 0!=t&&(this._isReady=!0,!0)},t.prototype.coordSetForKey=function(t){return this._coordSetByKey[t]},t.prototype.coordSetForId=function(t){return this._coordSetById[t]},t=io([Object(i.Injectable)(),ro("design:paramtypes",["function"==typeof(e="undefined"!=typeof gt&&gt)&&e||Object])],t);var e}(),co=this&&this.__extends||(Ye=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}Ye(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),ao=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},lo=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},uo=function(t){function e(e,o,n,i,r,s){var c=t.call(this)||this;return c.gridObservable=e,c.lookupCache=o,c.coordSetCache=n,c.dispGroupCache=i,c.itemSelectService=s,c.canvas=null,c.coordSetId=null,c.lastCanvasSize="",c.lastWindowHeight=0,c._privatePosService=r,c.config=new Zt,c.model=new $e(c.config,e,o,c),c.dispDelegate=new ke(c.config,i),c.input=new We(c.config,c.model,c.dispDelegate,c),c.renderer=new Ae(c.config,c.model,c.dispDelegate,c),c.renderer.drawEvent.takeUntil(c.onDestroyEvent).subscribe(function(t){return c.input.draw(t)}),c.connectItemSelectionService(),c.connectDiagramService(),c.connectPositionUpdateNotify(),c}return co(e,t),e.prototype.isReady=function(){return this.coordSetCache.isReady()&&this.gridObservable.isReady()&&this.lookupCache.isReady()},e.prototype.ngOnInit=function(){var t=this;this.dispGroupCache.setModelSetKey(this.modelSetKey),this.lookupCache.setModelSetKey(this.modelSetKey),this.canvas=this.canvasView.nativeElement,this.input.setCanvas(this.canvas),this.renderer.setCanvas(this.canvas);var e=Le(this.canvas);Le("body").css("overflow","hidden"),this.doCheckEvent.takeUntil(this.onDestroyEvent).subscribe(function(){var o=Le(window).height();if(t.lastWindowHeight!=o){t.lastWindowHeight=o;var n=o-e.offset().top;e.css("height",n+"px"),e.css("width","100%")}}),this.doCheckEvent.takeUntil(this.onDestroyEvent).subscribe(function(){var o=e.offset(),n=new Wt(o.left,o.top,e.width(),e.height()),i=n.toString();t.lastCanvasSize!=i&&(t.lastCanvasSize=i,t.canvas.height=t.canvas.clientHeight,t.canvas.width=t.canvas.clientWidth,t.config.updateCanvasWindow(n))})},e.prototype.mouseInfo=function(){return this.config.mouse.currentViewPortPosition.x.toFixed(2)+"x"+this.config.mouse.currentViewPortPosition.y.toFixed(2)+"X"+this.config.viewPort.zoom.toFixed(2)+", "+this.config.model.dispOnScreen+" Items"},e.prototype.switchToCoordSet=function(t){if(this.isReady()){var e=this.coordSetCache.coordSetForKey(t);this.config.updateCoordSet(e),this._privatePosService.setTitle("Viewing "+e.name),this.config.updateCoordSet(e),this._privatePosService.setReady(!0)}},e.prototype.connectPositionUpdateNotify=function(){var t=this,e=function(){null!=t.config.controller.coordSet&&t._privatePosService.positionUpdated({coordSetKey:t.config.controller.coordSet.key,x:t.config.viewPort.pan.x,y:t.config.viewPort.pan.y,zoom:t.config.viewPort.zoom})};this.config.viewPort.panChange.takeUntil(this.onDestroyEvent).subscribe(e),this.config.viewPort.zoomChange.takeUntil(this.onDestroyEvent).subscribe(e),this.config.controller.coordSetChange.takeUntil(this.onDestroyEvent).subscribe(e)},e.prototype.connectItemSelectionService=function(){var t=this;this.model.selectionChangedObservable().takeUntil(this.onDestroyEvent).subscribe(function(e){1==e.length&&t.itemSelectService.selectItem({modelSetKey:t.modelSetKey,coordSetKey:t.config.controller.coordSet.key,dispKey:Yt.key(e[0]),dispData:Yt.data(e[0])})})},e.prototype.connectDiagramService=function(){var t=this,e=this.doCheckEvent.takeUntil(this.onDestroyEvent).subscribe(function(){t.isReady()&&(e.unsubscribe(),t._privatePosService.setReady(!0))});this._privatePosService.positionByCoordSetObservable().takeUntil(this.onDestroyEvent).subscribe(function(e){t.isReady()?t.switchToCoordSet(e):console.log("ERROR, Position was called before canvas is ready")}),this._privatePosService.positionObservable().takeUntil(this.onDestroyEvent).subscribe(function(e){null!=t.config.controller.coordSet&&t.config.controller.coordSet.key==e.coordSetKey||t.switchToCoordSet(e.coordSetKey),t.config.updateViewPortPan({x:e.x,y:e.y}),t.config.updateViewPortZoom(e.zoom)})},ao([Object(i.ViewChild)("canvas"),lo("design:type",Object)],e.prototype,"canvasView",void 0),ao([Object(i.Input)("modelSetKey"),lo("design:type",String)],e.prototype,"modelSetKey",void 0),e=ao([Object(i.Component)({selector:"pl-diagram-canvas",template:o("nHid"),styles:[o("lt2r")]}),lo("design:paramtypes",["function"==typeof(n="undefined"!=typeof Ut&&Ut)&&n||Object,"function"==typeof(r="undefined"!=typeof St&&St)&&r||Object,"function"==typeof(s="undefined"!=typeof so&&so)&&s||Object,"function"==typeof(c="undefined"!=typeof Ft&&Ft)&&c||Object,"function"==typeof(a="undefined"!=typeof u&&u)&&a||Object,"function"==typeof(l="undefined"!=typeof h&&h)&&l||Object])],e);var n,r,s,c,a,l}(c.ComponentLifecycleEventEmitter),fo=this&&this.__extends||(Xe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}Xe(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),po=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},ho=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},yo=function(t){function e(){return t.call(this,o.tupleName)||this}return fo(e,t),o=e,e.tupleName=N+"LocationIndexTuple",e=o=po([c.addTupleType,ho("design:paramtypes",[])],e);var o}(c.Tuple),vo=this&&this.__extends||(Qe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}Qe(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),_o=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},go=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},bo=function(t){function e(){var e=t.call(this,o.tupleName)||this;return e.initialLoadComplete=!1,e.indexBucketUpdateDates={},e}return vo(e,t),o=e,e.tupleName=N+"LocationIndexUpdateDateTuple",e=o=_o([c.addTupleType,go("design:paramtypes",[])],e);var o}(c.Tuple),mo=this&&this.__extends||(Je=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}Je(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),So=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},wo=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Oo=function(t){function e(){return t.call(this,o.tupleName)||this}return mo(e,t),o=e,e.fromLocationJson=function(t){var e=new o;return e.coordSetId=t[0],e.dispId=t[1],e.x=t[2],e.y=t[3],e},e.tupleName=N+"DispKeyLocationTuple",e=o=So([c.addTupleType,wo("design:paramtypes",[])],e);var o}(c.Tuple),jo=this&&this.__extends||(qe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}qe(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),Po=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},xo=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ro=(o("Ad+1"),Object(c.extend)({key:"clientLocationIndexWatchUpdateFromDevice"},L)),To=function(t){function e(e){return t.call(this,yo.tupleName,{key:e})||this}return jo(e,t),e}(c.TupleSelector),Do=function(t){function e(e){return t.call(this,bo.tupleName,{modelSetKey:e})||this}return jo(e,t),e}(c.TupleSelector);var Co,Eo,Io,Bo,ko,Go=function(){function t(t,e,o,n){this.vortexService=t,this.vortexStatusService=e,this.coordSetService=n,this.indexByModelSet={},this.storage=new c.TupleOfflineStorageService(o,new c.TupleOfflineStorageNameService(z))}return t.prototype.indexForModelSetKey=function(t){var e=null;if(this.indexByModelSet.hasOwnProperty(t)){if((e=this.indexByModelSet[t]).isReady())return Promise.resolve(e)}else e=new Ao(this.vortexService,this.vortexStatusService,this.storage,t,this.coordSetService),this.indexByModelSet[t]=e;return new Promise(function(t,o){e.isReadyObservable().first().subscribe(function(){t(e)})})},t=Po([Object(i.Injectable)(),xo("design:paramtypes",["function"==typeof(e="undefined"!=typeof c.VortexService&&c.VortexService)&&e||Object,"function"==typeof(o="undefined"!=typeof c.VortexStatusService&&c.VortexStatusService)&&o||Object,"function"==typeof(n="undefined"!=typeof c.TupleStorageFactoryService&&c.TupleStorageFactoryService)&&n||Object,"function"==typeof(r="undefined"!=typeof so&&so)&&r||Object])],t);var e,o,n,r}(),Ao=function(){function t(t,e,o,n,i){this.vortexService=t,this.vortexStatusService=e,this.storage=o,this.modelSetKey=n,this.coordSetService=i,this.index=new bo,this.lifecycleEmitter=new c.ComponentLifecycleEventEmitter,this._hasLoaded=!1,this._hasLoadedSubject=new f.Subject,this.index.modelSetKey=this.modelSetKey,this.initialLoad()}return t.prototype.isReady=function(){return this._hasLoaded},t.prototype.isReadyObservable=function(){return this._hasLoadedSubject},t.prototype.initialLoad=function(){var t=this;this.storage.loadTuples(new Do(this.modelSetKey)).then(function(e){0!=e.length&&(t.index=e[0],t.index.initialLoadComplete&&(t._hasLoaded=!0,t._hasLoadedSubject.next())),t.setupVortexSubscriptions(),t.askServerForUpdates()})},t.prototype.setupVortexSubscriptions=function(){var t=this,e=Object(c.extend)({modelSetKey:this.modelSetKey},Ro);this.vortexService.createEndpointObservable(this.lifecycleEmitter,e).takeUntil(this.lifecycleEmitter.onDestroyEvent).subscribe(function(e){return t.processLocationIndexesFromServer(e)}),this.vortexStatusService.isOnline.filter(function(t){return 1==t}).takeUntil(this.lifecycleEmitter.onDestroyEvent).subscribe(function(){return t.askServerForUpdates()})},t.prototype.askServerForUpdates=function(){if(this.vortexStatusService.snapshot.isOnline){var t=new bo;t.indexBucketUpdateDates=this.index.indexBucketUpdateDates;var e=Object(c.extend)({modelSetKey:this.modelSetKey},Ro),o=new c.Payload(e,[t]);this.vortexService.sendPayload(o)}},t.prototype.processLocationIndexesFromServer=function(t){var e=this;if(null==t.result||1==t.result){if(1==t.filt.finished)return this.index.initialLoadComplete=!0,void this.storage.saveTuples(new Do(this.modelSetKey),[this.index]).then(function(){e._hasLoaded=!0,e._hasLoadedSubject.next()}).catch(function(t){return console.log("ERROR : "+t)});for(var o=[],n=0,i=t.tuples;n<i.length;n++){var r=i[n];o.push(r)}this.storeLocationIndexTuples(o).then(function(){for(var t=0,n=o;t<n.length;t++){var i=n[t];e.index.indexBucketUpdateDates[i.indexBucket]=i.lastUpdate}return e.storage.saveTuples(new Do(e.modelSetKey),[e.index])}).catch(function(t){return console.log("LocationIndexCache.storeLocationIndexTuples: "+t)})}else console.log("ERROR: "+t.result)},t.prototype.storeLocationIndexTuples=function(t){return this.storage.transaction(!0).then(function(e){for(var o=[],n=0,i=t;n<i.length;n++){var r=i[n];o.push(e.saveTuplesEncoded(new To(r.indexBucket),r.encodedLocationIndexTuple))}return Promise.all(o).then(function(){return e.close()})})},t.prototype.getLocations=function(t){var e=this;if(null==t||0==t.length){return Promise.resolve([])}var o=function(t,e){if(null==t||0==t.length)throw new Error("modelSetkey is None or zero length");if(null==e||0==e.length)throw new Error("dispKey is None or zero length");for(var o=0,n=0;n<e.length;n++)o=(o<<5)-o+e.charCodeAt(n),o|=0;return t+":"+(o&=1023)}(this.modelSetKey,t);return this.index.indexBucketUpdateDates.hasOwnProperty(o)?this.storage.loadTuples(new To(o)).then(function(o){if(0==o.length)return[];if(1!=o.length)throw new Error("We received more tuples then expected");for(var n=JSON.parse(o[0].jsonStr),i=null,r=0;r<n.length;r++)if(n[r][0]==t){i=n[r].slice(1);break}if(null==i)return[];for(var s=[],c=0,a=i;c<a.length;c++){var l=a[c],u=Oo.fromLocationJson(l),f=e.coordSetService.coordSetForId(u.coordSetId);null!=f&&(u.coordSetKey=f.key,s.push(u))}return s}):(console.log("DispKey "+t+" doesn't appear in the index"),Promise.resolve([]))},t}(),Lo=o("gCqq"),No=this&&this.__extends||(Co=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}Co(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),Mo=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},Ko=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Uo=function(t){function e(e,o){var n=t.call(this)||this;return n.locationIndexFactoryService=e,n.balloonMsg=o,n.titleUpdatedSubject=new f.Subject,n.positionByCoordSetSubject=new f.Subject,n.positionSubject=new f.Subject,n.positionByKeySubject=new f.Subject,n.isReadySubject=new f.Subject,n.postionUpdatedSubject=new f.Subject,n}return No(e,t),e.prototype.positionByCoordSet=function(t){this.positionByCoordSetSubject.next(t)},e.prototype.position=function(t,e,o,n){this.positionSubject.next({coordSetKey:t,x:e,y:o,zoom:n})},e.prototype.positionByKey=function(t,e,o){var n=this;this.locationIndexFactoryService.indexForModelSetKey(t).then(function(o){o.getLocations(e).then(function(o){0==o.length&&n.balloonMsg.showError("Can not locate disply item "+e+" in model set "+t);var i=o[0];n.positionSubject.next({coordSetKey:i.coordSetKey,x:i.x,y:i.y,zoom:2})})})},e.prototype.canPositionByKey=function(t,e){return this.locationIndexFactoryService.indexForModelSetKey(t).then(function(t){return t.getLocations(e).then(function(t){return 0!=t.length})})},e.prototype.setReady=function(t){this.isReadySubject.next(!0)},e.prototype.setTitle=function(t){this.titleUpdatedSubject.next(t)},e.prototype.positionUpdated=function(t){this.postionUpdatedSubject.next(t)},e.prototype.isReadyObservable=function(){return this.isReadySubject},e.prototype.positionUpdatedObservable=function(){return this.postionUpdatedSubject},e.prototype.titleUpdatedObservable=function(){return this.titleUpdatedSubject},e.prototype.positionObservable=function(){return this.positionSubject},e.prototype.positionByKeyObservable=function(){return this.positionByKeySubject},e.prototype.positionByCoordSetObservable=function(){return this.positionByCoordSetSubject},e=Mo([Object(i.Injectable)(),Ko("design:paramtypes",["function"==typeof(o="undefined"!=typeof Go&&Go)&&o||Object,"function"==typeof(n="undefined"!=typeof Lo.Ng2BalloonMsgService&&Lo.Ng2BalloonMsgService)&&n||Object])],e);var o,n}(u),Vo=this&&this.__extends||(Eo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}Eo(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),zo=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},Fo=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Wo=function(t){function e(e){var o=t.call(this)||this;return o.lookupCache=e,o}return Vo(e,t),e.prototype.ngOnInit=function(){},e=zo([Object(i.Component)({selector:"pl-diagram-layer",template:o("zSxQ")}),Fo("design:paramtypes",["function"==typeof(n="undefined"!=typeof St&&St)&&n||Object])],e);var n}(c.ComponentLifecycleEventEmitter),Zo=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},Ho=function(){function t(){}return t=Zo([Object(i.NgModule)({imports:[b.b].concat(m.a.FormsModules),exports:[uo],providers:[so,Lt,St,Ft,Ut,{provide:u,useClass:Uo},h,Go],declarations:[uo,Wo]})],t)}(),Yo=this&&this.__extends||(Io=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}Io(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),Xo=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},Qo=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Jo=function(t){function e(){return t.call(this)||this}return Yo(e,t),o=e,e.initHandler=function(){o.isInitialised||(o.isInitialised=!0,o.iface=window.nsWebViewInterface,o.iface.on("GridLoaderBridge_observable",function(t){var e=(new c.Payload).fromJsonDict(t).tuples;console.log("WEB: Received GridLoaderBridge_observable event"),o.updateSubject.next(e)}),o.iface.on("GridLoaderBridge_isReadyObservable",function(t){console.log("WEB: Received GridLoaderBridge_isReadyObservable event"),o.isReadyVal=t,o.readySubject.next(t)}),o.iface.emit("GridLoaderBridge_start","nothing"))},Object.defineProperty(e.prototype,"observable",{get:function(){return o.updateSubject},enumerable:!0,configurable:!0}),e.prototype.isReady=function(){return o.initHandler(),o.isReadyVal},e.prototype.isReadyObservable=function(){return o.readySubject},e.prototype.cacheAll=function(){throw new Error("Not Implemented")},e.prototype.loadGrids=function(t,e){var n={currentGridUpdateTimes:t,gridKeys:e},i=new c.Payload({},n).toJsonDict();console.log("WEB: Sending GridLoaderBridge_loadGrids event"),o.iface.emit("GridLoaderBridge_loadGrids",i)},e.prototype.watchGrids=function(t){var e=new c.Payload({},t).toJsonDict();console.log("WEB: Sending GridLoaderBridge_watchGrids event"),o.iface.emit("GridLoaderBridge_watchGrids",e)},e.updateSubject=new f.Subject,e.readySubject=new f.Subject,e.isReadyVal=!1,e.isInitialised=!1,e=o=Xo([Object(i.Injectable)(),Qo("design:paramtypes",[])],e);var o}(Bt),qo=o("HzFD"),$o=this&&this.__extends||(Bo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}Bo(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),tn=function(t){function e(o){var n=t.call(this,o)||this;return e.initHandler(),n}return $o(e,t),e.initHandler=function(){e.isInitialised||(e.isInitialised=!0,window.nsWebViewInterface.on("tupleStoragePromiseFinished",function(t){var o=(new c.Payload).fromJsonDict(t).tuples;console.log("WEB: Received tupleStoragePromiseResolved event"),e.promsById[o.promId][o.action](o.result),delete e.promsById[o.promId]}))},e.prototype.open=function(){return Promise.resolve()},e.prototype.isOpen=function(){return!0},e.prototype.close=function(){},e.prototype.transaction=function(t){return Promise.resolve(new en(t))},e.promsById={},e.nextPromiseId=1,e.isInitialised=!1,e}(c.TupleStorageServiceABC),en=function(){function t(t){this.forWrite=t,this.iface=window.nsWebViewInterface}return t.prototype.loadTuples=function(t){return this.loadTuplesEncoded(t).then(function(t){return null==t?[]:c.Payload.fromVortexMsg(t).then(function(t){return t.tuples})})},t.prototype.loadTuplesEncoded=function(t){var e=this,o=tn.nextPromiseId++;return new Promise(function(n,i){tn.promsById[o]={resolve:n,reject:i};var r={promId:o,tupleSelector:t},s=new c.Payload({},r).toJsonDict();console.log("WEB: Sending loadTuplesEncoded event"),e.iface.emit("loadTuplesEncoded",s)})},t.prototype.saveTuples=function(t,e){var o=this;return new c.Payload({},e).toVortexMsg().then(function(e){return o.saveTuplesEncoded(t,e)})},t.prototype.saveTuplesEncoded=function(t,e){var o=this,n=tn.nextPromiseId++;return new Promise(function(i,r){tn.promsById[n]={resolve:i,reject:r};var s={promId:n,tupleSelector:t,vortexMsg:e},a=new c.Payload({},s).toJsonDict();console.log("WEB: Sending saveTuplesEncoded event"),o.iface.emit("saveTuplesEncoded",a)})},t.prototype.close=function(){return Promise.resolve()},t}(),on=this&&this.__extends||(ko=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}ko(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),nn=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},rn=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},sn=function(t){function e(){return t.call(this,null)||this}return on(e,t),e.prototype.create=function(t){return new tn(t)},e.prototype.createActionStorage=function(){throw new Error("Action storage not implemented yet")},e=nn([Object(i.Injectable)(),rn("design:paramtypes",[])],e)}(qo.TupleStorageFactoryService),cn=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},an=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ln=function(){function t(t,e,o,n){var i=new c.TupleDataObservableNameService(M,L),r=new c.TupleOfflineStorageNameService(U),s=(new c.TupleActionPushNameService(K,L),new c.TupleOfflineStorageService(o,r));this.tupleOfflineObserver=new c.TupleDataOfflineObserverService(t,e,n,i,s)}return Object.defineProperty(t.prototype,"tupleOfflineAction",{get:function(){throw new Error("tupleOfflineAction is not implemented")},enumerable:!0,configurable:!0}),t=cn([Object(i.Injectable)(),an("design:paramtypes",["function"==typeof(e="undefined"!=typeof c.VortexService&&c.VortexService)&&e||Object,"function"==typeof(o="undefined"!=typeof c.VortexStatusService&&c.VortexStatusService)&&o||Object,"function"==typeof(n="undefined"!=typeof c.TupleStorageFactoryService&&c.TupleStorageFactoryService)&&n||Object,"function"==typeof(r="undefined"!=typeof i.NgZone&&i.NgZone)&&r||Object])],t);var e,o,n,r}(),un=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s};function fn(){return new Ot.b([])}var pn=function(){function t(){}return t=un([Object(i.NgModule)({declarations:[g],imports:[s.a,Ho],providers:[{provide:c.TupleStorageFactoryService,useClass:sn},{provide:gt,useClass:ln},{provide:Ot.b,useFactory:fn},{provide:Bt,useClass:Jo},Lo.Ng2BalloonMsgService,c.VortexStatusService,c.VortexService],bootstrap:[g]})],t)}();Object(i.enableProdMode)(),Object(r.a)().bootstrapModule(pn)},gFIY:function(t,e){function o(t){return Promise.resolve().then(function(){throw new Error("Cannot find module '"+t+"'.")})}o.keys=function(){return[]},o.resolve=o,t.exports=o,o.id="gFIY"},lt2r:function(t,e,o){(t.exports=o("rP7Y")(!1)).push([t.i,".canvas-status-bar{z-index:3;position:absolute;margin:0 auto;color:grey;right:10px}canvas{width:100%;z-index:1}",""]),t.exports=t.exports.toString()},nHid:function(t,e){t.exports='<div>\n    <p class="canvas-status-bar ">{{mouseInfo()}}</p>\n\n    <canvas #canvas class="canvas " >\n        Sorry, your browser doesn\'t support the &lt;canvas&gt; element.\n    </canvas>\n</div>\n'},"uI+l":function(t,e){var o=CanvasRenderingContext2D.prototype;o.roundRect=function(t,e,o,n,i){var r=t+o,s=e+n,c=Math.PI/180;r-t-2*i<0&&(i=(r-t)/2),s-e-2*i<0&&(i=(s-e)/2),this.beginPath(),this.moveTo(t+i,e),this.lineTo(r-i,e),this.arc(r-i,e+i,i,270*c,360*c,!1),this.lineTo(r,s-i),this.arc(r-i,s-i,i,0*c,90*c,!1),this.lineTo(t+i,s),this.arc(t+i,s-i,i,90*c,180*c,!1),this.lineTo(t,e+i),this.arc(t+i,e+i,i,180*c,270*c,!1),this.closePath()},o.dashedLine=function(t,e,o,n,i){this.moveTo(t,e);for(var r=o-t,s=n-e,c=Math.floor(Math.sqrt(r*r+s*s)/i),a=r/c,l=s/c,u=0;u++<c;)t+=a,e+=l,this[u%2==0?"moveTo":"lineTo"](t,e);this[u%2==0?"moveTo":"lineTo"](o,n)},o.dashedRect=function(t,e,o,n,i){if(0==i)this.beginPath(),this.rect(t,e,o,n),this.closePath();else{this.beginPath();var r=t+o,s=e+n;this.dashedLine(t,e,r,e,i),this.dashedLine(r,e,r,s,i),this.dashedLine(r,s,t,s,i),this.dashedLine(t,s,t,e,i),this.closePath()}}},zSxQ:function(t,e){t.exports='<button class="btn">tb1</button>\n<button class="btn">tb2</button>'}},[0]);